<!DOCTYPE html>
<html>
  <head>
    <title>Yaman's Cosmic Force</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.3/dist/aframe-environment-component.min.js"></script>

    <script>
      AFRAME.registerComponent('cosmic-dust', {
        schema: {
          count: { type: 'int', default: 20000 } // 20k Particles for maximum density
        },

        init: function () {
          // --- 1. SETUP ---
          this.particleCount = this.data.count;
          this.geometry = new THREE.BufferGeometry();
          this.positions = new Float32Array(this.particleCount * 3);
          this.velocities = new Float32Array(this.particleCount * 3); // Har particle ki speed store hogi
          this.colors = new Float32Array(this.particleCount * 3);

          // Hands References
          this.leftHand = document.querySelector('#leftHand');
          this.rightHand = document.querySelector('#rightHand');

          // Initial Explosion (Big Bang)
          for (let i = 0; i < this.particleCount; i++) {
            const i3 = i * 3;
            // Random positions in a big box
            this.positions[i3] = (Math.random() - 0.5) * 10;
            this.positions[i3 + 1] = (Math.random() - 0.5) * 10 + 1.6;
            this.positions[i3 + 2] = (Math.random() - 0.5) * 10 - 2;

            // Velocities (thoda movement shuru mein)
            this.velocities[i3] = (Math.random() - 0.5) * 0.01;
            this.velocities[i3 + 1] = (Math.random() - 0.5) * 0.01;
            this.velocities[i3 + 2] = (Math.random() - 0.5) * 0.01;

            // Base Color (Cyan/Blue)
            this.colors[i3] = 0.0;     // R
            this.colors[i3 + 1] = 0.8; // G
            this.colors[i3 + 2] = 1.0; // B
          }

          this.geometry.setAttribute('position', new THREE.BufferAttribute(this.positions, 3));
          this.geometry.setAttribute('color', new THREE.BufferAttribute(this.colors, 3));

          // Neon Shader Material (Glowing Dots)
          const material = new THREE.PointsMaterial({
            size: 0.04,
            vertexColors: true, // Har particle ka alag color
            transparent: true,
            opacity: 0.9,
            blending: THREE.AdditiveBlending, // Glow effect create karta hai
            depthWrite: false
          });

          this.system = new THREE.Points(this.geometry, material);
          this.el.setObject3D('mesh', this.system);
        },

        tick: function (t, dt) {
          const positions = this.geometry.attributes.position.array;
          const velocities = this.velocities;
          const colors = this.geometry.attributes.color.array;

          // Hand Positions Check (Fallback to default if not tracked)
          let lhPos = new THREE.Vector3(-1000, -1000, -1000); // Far away by default
          let rhPos = new THREE.Vector3(-1000, -1000, -1000);

          if (this.leftHand && this.leftHand.object3D) lhPos = this.leftHand.object3D.position;
          if (this.rightHand && this.rightHand.object3D) rhPos = this.rightHand.object3D.position;

          // --- PHYSICS LOOP (The Heavy Lifting) ---
          for (let i = 0; i < this.particleCount; i++) {
            const i3 = i * 3;
            
            // Current Pos
            let x = positions[i3];
            let y = positions[i3 + 1];
            let z = positions[i3 + 2];

            // 1. LEFT HAND: REPULSION (Push Away) - Shield
            // Calculate distance to Left Hand
            const dxL = x - lhPos.x;
            const dyL = y - lhPos.y;
            const dzL = z - lhPos.z;
            const distLSq = dxL*dxL + dyL*dyL + dzL*dzL;

            if (distLSq < 2.0) { // Sirf paas wale particles par asar
               const force = 0.02 / (distLSq + 0.1); // Strong force when close
               velocities[i3] += dxL * force;
               velocities[i3+1] += dyL * force;
               velocities[i3+2] += dzL * force;
            }

            // 2. RIGHT HAND: ATTRACTION (Black Hole) - Pull In
            const dxR = rhPos.x - x;
            const dyR = rhPos.y - y;
            const dzR = rhPos.z - z;
            const distRSq = dxR*dxR + dyR*dyR + dzR*dzR;

            if (distRSq < 4.0 && distRSq > 0.05) { // Bahut paas aane par explode na ho
               const force = 0.005 / (distRSq + 0.1); 
               velocities[i3] += dxR * force;
               velocities[i3+1] += dyR * force;
               velocities[i3+2] += dzR * force;
            }

            // 3. APPLY VELOCITY (Move the particle)
            positions[i3] += velocities[i3];
            positions[i3 + 1] += velocities[i3 + 1];
            positions[i3 + 2] += velocities[i3 + 2];

            // 4. FRICTION & CONTAINMENT (Taaki bhaag na jaye)
            velocities[i3] *= 0.96;     // Friction (Slow down over time)
            velocities[i3 + 1] *= 0.96;
            velocities[i3 + 2] *= 0.96;

            // Reset if too far away (Teleport back to center area)
            if (x > 10 || x < -10 || y > 10 || y < -2 || z > 5 || z < -10) {
               positions[i3] = (Math.random() - 0.5) * 5;
               positions[i3 + 1] = (Math.random() - 0.5) * 5 + 1.6;
               positions[i3 + 2] = (Math.random() - 0.5) * 5 - 2;
               velocities[i3] = 0; velocities[i3+1] = 0; velocities[i3+2] = 0;
            }

            // 5. DYNAMIC COLOR (Based on Speed)
            // Jitna tez, utna White/Yellow. Jitna slow, utna Blue/Purple.
            const speed = Math.sqrt(velocities[i3]*velocities[i3] + velocities[i3+1]*velocities[i3+1] + velocities[i3+2]*velocities[i3+2]);
            
            colors[i3] = speed * 10;     // Red badhao speed ke sath
            colors[i3 + 1] = 0.5 + speed * 5; // Green mix
            colors[i3 + 2] = 1.0 - speed * 2; // Blue kam karo speed ke sath
          }

          this.geometry.attributes.position.needsUpdate = true;
          this.geometry.attributes.color.needsUpdate = true;
        }
      });
    </script>
  </head>
  <body>
    <a-scene>
      <a-entity environment="preset: starry; groundColor: #000; grid: none; skyType: atmosphere"></a-entity>

      <a-entity cosmic-dust></a-entity>

      <a-entity id="leftHand" hand-tracking-controls="hand: left; modelStyle: dots">
        <a-sphere radius="0.05" color="#FF0000" opacity="0.5" transparent="true"></a-sphere>
      </a-entity>
      
      <a-entity id="rightHand" hand-tracking-controls="hand: right; modelStyle: dots">
         <a-sphere radius="0.05" color="#00FF00" opacity="0.5" transparent="true"></a-sphere>
      </a-entity>

      <a-text value="Right Hand: PULL | Left Hand: PUSH" position="0 2.5 -3" align="center" color="#FFF" width="8"></a-text>

      <a-entity camera look-controls position="0 1.6 0"></a-entity>
    </a-scene>
  </body>
</html>
